var swi={},util=function(){function i(n,t){return!n||!t?!1:n.cellX===t.cellX&&n.cellY===t.cellY&&n.zoneX===t.zoneX&&n.zoneY===t.zoneY}function r(t,r){var u,f;if(!t||!r)return!1;u=n(t);for(f in u)if(i(u[f],r))return!0;return!1}function n(n){var i=n.cellX===0?n.zoneX-1:n.zoneX,r=n.cellX===0?t-1:n.cellX-1,u=n.cellX===t-1?n.zoneX+1:n.zoneX,f=n.cellX===t-1?0:n.cellX+1,e=n.cellY===0?n.zoneY-1:n.zoneY,o=n.cellY===0?t-1:n.cellY-1,s=n.cellY===t-1?n.zoneY+1:n.zoneY,h=n.cellY===t-1?0:n.cellY+1;return{topLeft:{zoneX:i,zoneY:e,cellX:r,cellY:o},top:{zoneX:n.zoneX,zoneY:e,cellX:n.cellX,cellY:o},topRight:{zoneX:u,zoneY:e,cellX:f,cellY:o},left:{zoneX:i,zoneY:n.zoneY,cellX:r,cellY:n.cellY},right:{zoneX:u,zoneY:n.zoneY,cellX:f,cellY:n.cellY},bottomLeft:{zoneX:i,zoneY:s,cellX:r,cellY:h},bottom:{zoneX:n.zoneX,zoneY:s,cellX:n.cellX,cellY:h},bottomRight:{zoneX:u,zoneY:s,cellX:f,cellY:h}}}function u(t){var i=n(t),r=n(i.topLeft),o=n(i.top),u=n(i.topRight),s=n(i.left),h=n(i.right),f=n(i.bottomLeft),c=n(i.bottom),e=n(i.bottomRight);return[i.topLeft,i.top,i.topRight,i.left,i.right,i.bottomLeft,i.bottom,i.bottomRight,r.topLeft,r.top,r.left,o.top,u.topRight,u.top,u.right,s.left,h.right,f.bottomLeft,f.bottom,f.left,c.bottom,e.bottomRight,e.bottom,e.right]}function f(n){var o,i="",t=Math.floor((new Date-n)/864e5),u,f,r,e;return t>270&&(o="numeric"),t>365?(u=Math.floor(t/365),i=u>1?"Over "+u+" years":"Over a year"):t>30?(f=Math.floor(t/30),i=f+" month"+(f>1?"s":"")):t>1?i=t+" day"+(t>1?"s":""):(r=Math.floor((new Date-n)/6e4),r>60?(e=Math.floor(r/60),i=e+" hour"+(e>1?"s":"")):i=r>1?r+" minute"+(r>1?"s":""):"Less than a minute"),n.toLocaleString("en-US",{year:o,month:"long",day:"numeric",hour:"numeric",minute:"numeric"})+" ("+i+" ago)"}function e(n){var t=[],f=Math.floor(n/100)%600/10,r=Math.floor(n/6e4)%60,u=Math.floor(n/36e5)%24,i=Math.floor(n/864e5);return i&&t.push(i+" day"+(i>1?"s":"")),u&&t.push(u+" hour"+(u>1?"s":"")),r&&t.push(r+" minute"+(r>1?"s":"")),i||t.push(f+" second"+(f>1?"s":"")),t.join(", ")}function o(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function s(n,t,i){return n<=t?t:n>=i?i:n}function h(n,t){return(n=n.toLowerCase(),t=t.toLowerCase(),n<t)?-1:n>t?1:0}function c(n){if(n&&n.length===24)try{if(atob(n).length===16)return!0}catch(t){}return!1}var t=16;return{MINES_PER_ROW:t,cellPointsEqual:i,cellPointsAdjacent:r,getAdjacentPoints:n,getRadius2AdjacentPoints:u,formatDate:f,formatTimeSpan:e,escapeHtml:o,clamp:s,stringSort:h,validateSid:c}}(),swavatar=function(){return{getAvatar:function(n,t,i,r){var u=n,f,e;if(u){if(i&1&&r&1&&(u=t),i&2){f=u.indexOf("‚Äç");f>=0?(e=u.substring(f),u=u.substring(0,f)):e="";switch(r>>1&7){case 1:u+="üèª";break;case 2:u+="üèº";break;case 3:u+="üèΩ";break;case 4:u+="üèæ";break;case 5:u+="üèø"}u+=e}}else u="üë§";return u[u.length-1]!=="Ô∏è"?u+"Ô∏è":u}}}(),swapp;swi.win=function(){function i(n){var t="";for(var i in n)n[i]!==undefined&&n[i]!==null&&(t?t+="&":t="?",t+=i+"="+encodeURIComponent(n[i]));return t}function u(){var f={},i,r,n,u,t,e;if(location.search.length>0)for(i=location.search.substring(1).split("&"),r={skin:/^([a-z0-9]+(?:-(\d{3}))?(?:-(\d{3}))?)$/i,debug:/^1$/,goto:/^(-?[0-9]+),(-?[0-9]+)$/,name:/^(.+)$/,recenter:/^1$/,pocket:/^([0-9a-z]{13})$/i,old:/^([0-9a-z]{13})$/i,size:/([1-9][0-9]?),([1-9][0-9]?)/,seed:/([0-9a-z]{1,200})/i,prob:/(1?[0-9]{1,2}\.?[0-9]{0,3})/},n=0;n<i.length;n++)u=i[n].split("=",2),t=u[0].toLowerCase(),r[t]&&(e=decodeURIComponent(u[1]),f[t]=r[t].exec(e));return f}var n={},r=!1,t=u();return t.skin&&(n.skin=t.skin[1].toLowerCase()),t.pocket&&(n.pocketInstance=t.pocket[1]),t.name&&(n.name=t.name[1],r=!0),t.goto&&(n.goto={x:Number(t.goto[1]),y:Number(t.goto[2])},r=!0),t.prob&&(n.prob=Number(t.prob[1])),t.seed&&(n.seed=t.seed[1]),t.size&&(n.sizeX=Number.parseInt(t.size[1]),n.sizeY=Number.parseInt(t.size[2])),t.old&&(n.old=t.old[1]),n.recenterflag=!!t.recenter,n.debugflag=!!t.debug,n.createPocket=function(t,r,u){location.search=i({size:t,prob:r,name:u,old:n.pocketInstance})},n.redirectToInfinity=function(){location.search=""},n.reloadAndGoto=function(t,r,u){location.search=i({goto:t+","+r,name:u,pocket:n.pocketInstance})},n.reload=function(t,r){location.search=i({name:t,pocket:r||n.pocketInstance})},n.registerCode=function(n,t){var i=0;window.addEventListener("keydown",function(r){r.key===n[i]?(i++,i===n.length&&(i=0,t())):i=0})},n.resetUrlWithInstance=function(n){history.replaceState(null,"","/"+i({pocket:n}))},r&&history.replaceState(null,"","/"+i({pocket:n.pocketInstance})),n}();swi.store=function(){var n={};return n.setCookie=function(n,t,i){if(t===undefined||t===null)document.cookie=n+"=;expires=Sun, 02 Oct 2016 22:00:00 UTC;path=/";else{var r=new Date;r.setTime(r.getTime()+15552e6);document.cookie=n+"="+t+(i?"":";expires="+r.toUTCString())+";path=/"}},n.getCookie=function(n){n+="=";var t=document.cookie.split(";").find(function(t){return t.trim().indexOf(n)===0});return t&&t.trim().substring(n.length)},n}();swi.ui=function(n){function v(n,t){while(n&&!t(n))n=n.parentElement;return n}var t={},s,h,e,o,r,u,c,f;t.setDebugMode=function(n){t.debugmode=!!n;document.getElementById("body").classList.toggle("debugmode",t.debugmode)};t.setDebugMode(n.debugflag);t.log=function(n){t.debugmode&&console.log(n)};s=document.getElementById("score");t.setScore=function(n){s.innerText=n};t.toggleMenu=function(n){document.getElementById("menucont").classList.toggle("hide",n===undefined?n:!n)};t.showUserSettings=function(n){document.getElementById("usersettingscont").classList.toggle("hide",!n)};h=document.getElementById("username");t.setName=function(n){h.innerText=n};t.showMenuError=function(n){document.getElementById("menuerror").innerText=n};t.getSidChange=function(){return document.getElementById("sidField").value};t.setSidChange=function(n){document.getElementById("sidField").value=n};e=document.getElementById("nameChangeField");t.getNameChange=function(){return e.value};t.setNameChange=function(n){e.value=n};o=document.getElementById("stealthModeField");t.getStealthMode=function(){return o.checked};t.setStealthMode=function(n){o.checked=n};t.loadSkinOptions=function(n,t){document.getElementById("skinoptions").innerHTML=n.map(function(n){return"<option "+(n.skinId===t?"selected ":"")+"value='"+n.skinId+"'>"+util.escapeHtml(n.friendlyName)+(n.isNew?" [NEW]":"")+"<\/option>"}).join("")};t.setSkinOption=function(n){document.getElementById("skinoptions").value=n};t.setSkinPreview=function(n,t){document.getElementById("skinoptionspreview").setAttribute("src","/skinpreview?skin="+(n||"base"));document.getElementById("skinoptionsflavor").innerText=t||""};t.getSkinOption=function(){return document.getElementById("skinoptions").value};t.loadAvatarOptions=function(n,t){var i=t&&t.avatarId;document.getElementById("avataroptions").innerHTML="<option "+(t?"":"selected ")+"value=''>No avatar<\/option>"+n.map(function(n){return"<option "+(n.avatarId===i?"selected ":"")+"value='"+n.avatarId+"'>"+util.escapeHtml(n.friendlyName)+": "+n.avatar+"Ô∏è"+(n.isNew?" [NEW]":"")+"<\/option>"}).join("")};t.setAvatarOption=function(n){document.getElementById("avataroptions").value=n||""};t.setAvatarPreview=function(n,t){document.getElementById("avataroptionspreview").innerText=n;document.getElementById("avatargender").classList.toggle("hide",!(t&1));document.getElementById("avatartone").classList.toggle("hide",!(t&2))};t.getAvatarOption=function(){return Number(document.getElementById("avataroptions").value)};t.getAvatarMod=function(){for(var r=0,u=0,t=document.getElementsByName("avatargenderoptions"),i=document.getElementsByName("avatartoneoptions"),n=0;n<t.length;n++)if(t[n].checked){r=Number(t[n].value);break}for(n=0;n<i.length;n++)if(i[n].checked){u=Number(i[n].value);break}return u<<1|r};t.setAvatarMod=function(n){for(var u=n&1,f=n>>1&7,i=document.getElementsByName("avatargenderoptions"),r=document.getElementsByName("avatartoneoptions"),t=0;t<i.length;t++)i[t].checked=Number(i[t].value)===u;for(t=0;t<r.length;t++)r[t].checked=Number(r[t].value)===f};t.setUserAvatar=function(n){document.getElementById("usersettingsavatar").innerText=n};r=document.getElementById("loot");u=document.getElementById("lootboxcount");t.setLootboxCount=function(n){u.innerText=n;n>0&&(r.classList.remove("hide"),window.setTimeout(function(){r.classList.remove("animated")},5e3));n>1?u.classList.remove("hide"):n===1?u.classList.add("hide"):n===0&&r.classList.add("hide")};t.showUserProfile=function(n,t){document.getElementById("userprofilecont").classList.toggle("hide",!n);t?document.getElementById("userprofiledata").innerHTML="<div class='scorestat'><div class='scorestatlabel'>Score<\/div>"+t.score+"<\/div><h3><div class='mediumavatar'>"+swavatar.getAvatar(t.avatar,t.avatarMale,3,t.avatarMod)+"<\/div>"+util.escapeHtml(t.name)+(t.isDead?" <span title='Died'>üíÄ<\/span>":"")+(t.isOnline?" <span title='Online now!'>üí°<\/span>":"")+"<\/h3><table class='stattable'>"+(t.createdTime?"<tr><th>Date created<\/th><td>"+util.formatDate(new Date(t.createdTime))+"<\/td><\/tr>":"")+(t.activeTime?"<tr><th>Last active<\/th><td>"+util.formatDate(new Date(t.activeTime))+"<\/td><\/tr>":"")+"<tr><th>Chain reactions<\/th><td>"+t.chains+"<\/td><\/tr><tr><th>Largest chain reaction<\/th><td>"+t.longestChain+" boxes<\/td><\/tr><\/table><div class='stattileslabel'>Types of boxes revealed:<\/div><div class='stattiles'>"+t.clears.map(function(n,t){return"<div><div class='tile"+t+"'><\/div>"+n+"<\/div>"}).join("")+"<div><div class='tilem'><\/div>"+t.minesRevealed+"<\/div><\/div>":document.getElementById("userprofiledata").innerText="Loading..."};t.showInventoryArea=function(n){document.getElementById("invocont").classList.toggle("hide",!n)};t.showInventory=function(n){document.getElementById("invodata").innerHTML="<h4>Skins<\/h4><ul>"+(n.skins.length===0?"None":n.skins.map(function(n){return"<li>"+n.name+" ("+n.quantity+")<\/li>"}).join(""))+"<\/ul><h4>Avatars<\/h4><ul>"+(n.avatars.length===0?"None":n.avatars.map(function(n){return"<li>"+n.name+" ("+n.quantity+")<\/li>"}).join(""))+"<\/ul>"};t.showItemReceived=function(n,i){var f=document.getElementById("itemcont"),r=document.getElementById("itemdata"),e=document.getElementById("itemmessage"),u;f.classList.contains("hide")?(r.innerHTML="",e.innerText="You received an item!",f.classList.remove("hide")):e.innerText="You received items!";u=i>1?"<div class='dupe'>Dupe! You have "+i+"<\/div>":"";switch(n.type){case 1:r.innerHTML+="<div class='sitem'><h4>Item: "+util.escapeHtml(n.friendlyName)+"<\/h4>"+u+"<\/div>";break;case 2:r.innerHTML+="<div class='sitem'><h4>Avatar: "+util.escapeHtml(n.friendlyName)+"<\/h4>"+u+"<div class='avatarpreview largeavatar'>"+n.avatar+"Ô∏è<\/div><div class='itemuse'><button type='button' onclick='swapp.selectAvatar("+n.avatarId+");swapp.dismissItem(event)'>Use now<\/button><\/div>"+(n.flavorText?"<div class='itemflavor'>"+util.escapeHtml(n.flavorText)+"<\/div>":"")+"<\/div>";break;case 3:r.innerHTML+="<div class='sitem'><h4>Skin: "+util.escapeHtml(n.friendlyName)+"<\/h4>"+u+"<iframe class='skinpreview' src='/skinpreview?skin="+n.skinId+"'><\/iframe><div style='margin-top:8px'><button type='button' onclick='swapp.selectSkin(\""+n.skinId+"\");swapp.dismissItem(event)'>Use now<\/button><\/div>"+(n.flavorText?"<div class='itemflavor'>"+util.escapeHtml(n.flavorText)+"<\/div>":"")+"<\/div>";break;default:t.log("Unknown item type: "+type)}};t.dismissItem=function(n){var i=v(n,function(n){return n.classList.contains("sitem")}),r;i&&i.remove();r=document.getElementById("itemdata").getElementsByClassName("sitem");r.length<=0&&t.closeItemArea()};t.closeItemArea=function(){document.getElementById("itemcont").classList.add("hide")};t.showHelpArea=function(n){document.getElementById("helpcont").classList.toggle("hide",!n)};t.showPocketArea=function(n){document.getElementById("pocketcont").classList.toggle("hide",!n)};t.showLeaderboardArea=function(n,t,i){document.getElementById("leaderboardcont").classList.toggle("hide",!n);var r=document.getElementById("leaderboarddata");i?r.innerHTML="<table><tr><th>User<\/th><th>Score<\/th><th>Last Active<\/th><\/tr>"+i.map(function(n){var t=swavatar.getAvatar(n.avatar,n.avatarMale,3,n.avatarModCode);return"<tr><td><span class='smallavatar'>"+t+"<\/span><span class='pseudolink' onclick='swapp.viewUserProfile("+n.streakId+")'>"+util.escapeHtml(n.name)+"<\/span>"+(n.isDead?" <span title='Died'>üíÄ<\/span>":"")+(n.isOnline?" <span title='Online now!'>üí°<\/span>":"")+"<\/td><td>"+n.score+"<\/td><td>"+(n.lastActive?util.formatDate(new Date(n.lastActive)):"")+"<\/td><\/tr>"}).join("")+"<\/table>":r.innerText=t?t:""};c=document.getElementById("scoreboard");t.updateScoreboard=function(n){c.innerHTML="<table>"+n.map(function(n){var t=swavatar.getAvatar(n.avatar,n.avatarMale,3,n.avatarMod);return"<tr><td><span class='smallavatar'>"+t+"<\/span><span class='pseudolink' onclick='swapp.viewUserProfile("+n.pid+")'>"+(n.isDead?"<s>":"")+(n.isActive?"":"<i>")+util.escapeHtml(n.name)+(n.isActive?"":"<\/i>")+(n.isDead?"<\/s>":"")+"<\/span>"+(n.isMe?" *":n.stealthMode?"":"<span onclick='swapp.teleportTo("+n.locationX+","+n.locationY+")' class='goto' title='"+n.distance+" boxes "+n.bearing+"'><\/span>")+"<\/td><td>"+n.score+"<\/td><\/tr>"}).join("")+"<\/table>"};t.toggleScoreboardSize=function(){document.getElementById("gameinfo").classList.toggle("showless")};t.getPocketSettings=function(){return{size:document.getElementById("pocketSizeField").value,prob:document.getElementById("pocketDifficultyField").value}};t.getTeleportCoords=function(){return{x:Math.floor(document.getElementById("teleportX").value),y:Math.floor(document.getElementById("teleportY").value)}};t.toggleShowTeleportCoords=function(){document.getElementById("teleportcoords").classList.toggle("hide")};t.setTeleportCoords=function(n,t){document.getElementById("teleportX").value=n;document.getElementById("teleportY").value=t};var i=document.getElementById("arearating"),l=0,a=0;return t.setZoneRating=function(n,t){if(n!==l&&(l=n,n<=0?(i.innerText="",i.className=""):n===1?(i.innerText="Low",i.className="rating1"):n===2?(i.innerText="‚ö†Ô∏è Medium",i.className="rating2"):n===3?(i.innerText="‚ö†Ô∏è High",i.className="rating3"):n===4?(i.innerText="‚ö†Ô∏è Very High",i.className="rating4"):n===5?(i.innerText="‚ö†Ô∏è Extremely High",i.className="rating5"):n===6&&(i.innerText="‚ö†Ô∏è Impossible",i.className="rating6")),t!==a){a=t;var r=(t/2.56).toFixed(1)+"%";n<=0?i.setAttribute("title",null):n===1?i.setAttribute("title","Low density of mines in this area: "+r):n===2?i.setAttribute("title","Medium density of mines in this area: "+r):n===3?i.setAttribute("title","High density of mines in this area: "+r):n===4?i.setAttribute("title","Very high density of mines in this area: "+r):n===5?i.setAttribute("title","Extremely high density of mines in this area: "+r):n===6&&i.setAttribute("title","This area is impossible. Turn back.")}},f=document.getElementById("minimap"),t.showMinimap=function(n){f.classList.toggle("hide",!n)},t.setMinimap=function(n,t){f.setAttribute("src","data:image/png;base64,"+n);f.addEventListener("click",t)},t.showGameOver=function(){document.getElementById("gamedone").classList.contains("hide")&&document.getElementById("gameover").classList.remove("hide")},t.showCleared=function(n){document.getElementById("gameover").classList.contains("hide")||document.getElementById("gameover").classList.add("hide");document.getElementById("gamedone").classList.remove("hide");n>0&&(document.getElementById("gamedonetime").innerText=util.formatTimeSpan(n))},t.showFieldCreating=function(){document.getElementById("gamedonenew").style.visibility="visible"},t.showFieldCreated=function(n){document.getElementById("gamedonenew").style.visibility="hidden";document.getElementById("gamedonenextbutton").disabled=!1;document.getElementById("gamedonenextbutton").addEventListener("click",n)},t.updateQuests=function(n){var t=document.getElementById("quests"),i,r,u;t.childNodes.forEach(function(t){var r=n.find(function(n){return"questi"+n.id===t.id}),i;r?(i=t.getElementsByClassName("questp"),i[0]&&(i[0].innerText="Progress: "+r.progress)):t.remove()});i=n.filter(function(n){for(var i in t.childNodes)if("questi"+n.id===t.childNodes[i].id)return!1;return!0});r=i.map(function(n){var t=document.createElement("template");return t.innerHTML="<div class='quest' id='questi"+n.id+"'><div style='background:"+n.color+"'><\/div><div><p>Quest #"+(n.index+1)+(n.zone?" <span class='goto' onclick='swapp.teleportTo("+n.zone.zoneX+","+n.zone.zoneY+")'><\/span>":"")+"<\/p><p>"+util.escapeHtml(n.description)+"<\/p><p class='questp'>Progress: "+n.progress+"<\/p><\/div><\/div>",document.importNode(t.content,!0)});for(u in r)t.appendChild(r[u]);return i},t.touch=function(){function t(n,t){t?document.getElementById(n).setAttribute("disabled",1):document.getElementById(n).removeAttribute("disabled")}var n=document.getElementById("touchtoggle"),i=document.getElementById("touchcontrols");return{setMode:function(t){n.classList.toggle("boff",!t);i.classList.toggle("hide",!t);t?n.setAttribute("title","Touch mode"):n.setAttribute("title","Mouse mode")},setButtons:function(n,i,r){t("touchreveal",!n);t("touchflag",!i);t("touchmagic",!r)}}}(),t.overlay=function(){function i(){t.classList.remove("hide");document.getElementById("gameinfo").classList.add("hide");document.getElementById("userinfo").classList.add("hide");document.getElementById("teleport").classList.add("hide")}function r(n){t.innerHTML=n;i()}function n(n){t.innerText=n;i()}var t=document.getElementById("overlay");return{hide:function(){t.classList.add("hide");document.getElementById("gameinfo").classList.remove("hide");document.getElementById("userinfo").classList.remove("hide");document.getElementById("teleport").classList.remove("hide");t.innerText=""},showConnecting:function(){n("Connecting...")},showLoggingIn:function(){n("Logging in...")},showMessage:function(t){n(t)},showRestartCounter:function(t){function i(){n("Disconnected. Retrying again in "+t+" seconds...")}i();window.setInterval(function(){t>0&&(t--,i())},1e3)},showAlreadyLoggedIn:function(){r("<div>You are already logged in elsewhere!<\/div><div><button type='button' onclick='swapp.resetGame()'>Reset<\/button> (Note: you'll lose any progress you previously made!)<\/div>")},showBadSecretId:function(){r("<div>Your secret ID is not valid.<\/div><div><button type='button' onclick='swapp.resetGame()'>Reset<\/button><\/div>")},showServerErrorCode:function(t){n("An unknown error occurred: code #"+t)},showSocketErrorState:function(t){n("Unknown WebSocket State: "+t)}}}(),t}(swi.win);swi.field=function(n,t){function tt(){var n,t;y&&e.removeLayer(y);y=new vt({tileSize:L.point(u.w,u.h)});y.on("tileunload",function(n){ft(n.coords.x,n.coords.y)});y.addTo(e);e.setMaxBounds([[(f.maxX+1)*u.w,(f.maxY+3)*u.h],[(f.minX-4)*u.w,(f.minY-2)*u.h]]);ct();n=lt();for(t in n)r.addQuestOverlay(n[t])}function b(n){var t=n.lng,i=-n.lat,r=Math.floor(t/u.w),f=Math.floor(i/u.h);return{zoneX:r,zoneY:f,cellX:Math.floor((t-r*u.w)/(u.w/util.MINES_PER_ROW)),cellY:Math.floor((i-f*u.h)/(u.h/util.MINES_PER_ROW))}}function kt(n,t){return{lng:(n+.5)*u.w,lat:-(t+.5)*u.h}}function dt(n,t){return t||(t=n),[{lng:n.zoneX*u.w,lat:-n.zoneY*u.h},{lng:(t.zoneX+1)*u.w,lat:-(t.zoneY+1)*u.h}]}function yt(n,t){return{lng:(n.zoneX+(n.cellX+(t?.5:0))/util.MINES_PER_ROW)*u.w,lat:-(n.zoneY+(n.cellY+(t?.5:0))/util.MINES_PER_ROW)*u.h}}function o(n){return"c"+n.zoneX+"x"+n.zoneY+"-"+n.cellX+"x"+n.cellY}function k(n){var t=document.getElementById(o(n)),i;t&&(i=l(t),i===undefined&&et(n)&&(t.classList.add("d"),pt(util.getAdjacentPoints(n))))}function pt(n){var e=[],t,s,i,u,f,h,c;for(t in n)if(n.hasOwnProperty(t)&&(s=o(n[t]),v[s])){e.push(n[t]);i=util.getAdjacentPoints(n[t]);for(u in i)if(f=document.getElementById(o(i[u])),f&&(h=l(f),c=it(util.getAdjacentPoints(i[u]),["f","m",undefined]),c===h)){r.revealCell(n[t],"M",!0);break}}ot(e)}function p(n){var t=o(n),r=document.getElementById(t),u,f;return r&&(u=l(r),u===undefined||u==="f")?(r.classList.toggle("f"),v[t]?delete v[t]:(v[t]=!0,f=util.getRadius2AdjacentPoints(n),f.push(n),pt(f)),(util.cellPointsEqual(i,n)||util.cellPointsAdjacent(i,n))&&h(i,!1),!0):!1}function g(n){var s=o(n),r=document.getElementById(s),i,u,t,f,e;if(r&&(i=l(r),i>=0))if(u=util.getAdjacentPoints(n),t={},it(u,["f","m",undefined],t),t.f.length+t.m.length===i)for(f in t[undefined])k(t[undefined][f]);else if(t.f.length+t.m.length+t[undefined].length===i)for(e in t[undefined])p(t[undefined][e]);return!1}function gt(n){var t=document.getElementById(o(n));t&&t.classList.remove("l")}function l(n){if(n.classList.contains("f"))return"f";if(n.classList.contains("m"))return"m";var t;return n.classList.forEach(function(n){n.length===2&&n[0]==="c"&&(t=parseInt(n[1]))}),t}function it(n,t,i){var e=0,s,r,h,u,f;if(i)for(s in t)i[t[s]]=[];for(r in n)h=o(n[r]),u=document.getElementById(h),u&&(f=l(u),t.some(function(n){return n===f})&&(e++,i&&i[f].push(n[r])));return e}function rt(){nt.forEach(function(n){n.classList.remove("d")});nt=[]}function ni(){c&&(c.remove(),c=null,i&&h(i,!1))}function h(n,t){if(i=n,i){var r=yt(i,!0);c?c.setLatLng(r):(c=L.marker(r,{icon:L.divIcon({className:"keycursor",iconSize:[u.w/util.MINES_PER_ROW,u.h/util.MINES_PER_ROW],html:""}),zIndexOffset:1e3,bubblingMouseEvents:!0}),c.addTo(e));t&&!e.getBounds().contains(r)&&e.panTo(r)}else c&&c.remove(),c=null;ti()}function ti(){var e=!1,u=!1,s=!1,h,f,r,c,n;i&&(h=o(i),f=document.getElementById(h),f&&(r=l(f),r===undefined?(e=!0,u=!0):r==="f"?u=!0:r>=0&&(c=util.getAdjacentPoints(i),n={},it(c,["f","m",undefined],n),(n.f.length+n.m.length===r||n.f.length+n.m.length+n[undefined].length===r)&&n[undefined].length>0&&(s=!0))));t.touch.setButtons(e,u,s)}function s(n){i?h(util.getAdjacentPoints(i)[n],!0):r.centerKeyCursor()}function wt(n){var r,u,t,h,f,e,o;if(Object.keys(a).length>0&&window.requestAnimationFrame(wt),document.hasFocus()){r=navigator.getGamepads();for(u in r)t=a[r[u]&&r[u].index],t&&(h=n-t.lastTimestamp,f=.01*h,r[u].buttons[0].pressed&&!t.revealState&&i&&k(i),t.revealState=r[u].buttons[0].pressed,r[u].buttons[1].pressed&&!t.flagState&&i&&p(i),t.flagState=r[u].buttons[1].pressed,(r[u].buttons[2].pressed||r[u].buttons[3].pressed)&&!t.magicState&&i&&g(i),t.magicState=r[u].buttons[2].pressed||r[u].buttons[3].pressed,e=r[u].axes[0]*r[u].axes[0]+r[u].axes[1]*r[u].axes[1]>.4*.4,o=r[u].axes[2]*r[u].axes[2]+r[u].axes[3]*r[u].axes[3]>.4*.4,t.xThresh+=e?f*r[u].axes[0]:0,t.yThresh+=e?f*r[u].axes[1]:0,t.xThresh+=o?f*r[u].axes[2]:0,t.yThresh+=o?f*r[u].axes[3]:0,t.directionLastPress===null?(r[u].buttons[12].pressed&&(t.yThresh=-1,t.directionLastPress=n),r[u].buttons[13].pressed&&(t.yThresh=1,t.directionLastPress=n),r[u].buttons[14].pressed&&(t.xThresh=-1,t.directionLastPress=n),r[u].buttons[15].pressed&&(t.xThresh=1,t.directionLastPress=n)):r[u].buttons[12].pressed||r[u].buttons[13].pressed||r[u].buttons[14].pressed||r[u].buttons[15].pressed?n-t.directionLastPress>400&&(t.yThresh+=r[u].buttons[12].pressed?-f:0,t.yThresh+=r[u].buttons[13].pressed?f:0,t.xThresh+=r[u].buttons[14].pressed?-f:0,t.xThresh+=r[u].buttons[15].pressed?f:0):t.directionLastPress=null,t.xThresh>=1?(t.xThresh--,s("right")):t.xThresh<=-1&&(t.xThresh++,s("left")),t.yThresh>=1?(t.yThresh--,s("bottom")):t.yThresh<=-1&&(t.yThresh++,s("top")),t.lastTimestamp=n)}}var r={defaultSkin:"base"},bt=/^[a-z0-9]+(?:-(\d{3}))?(?:-(\d{3}))?$/i,u={w:400,h:400},f={maxX:9007199254740,minX:-9007199254740,maxY:9007199254740,minY:-9007199254740},d=r.defaultSkin,ut,ft,et,ot,st,ht,ct,lt,at,v={},i,c,w,e,vt,y,nt,a;h(null,!1);e=L.map("mainmap",{crs:L.CRS.Simple,center:[0,0],maxBoundsViscosity:1,zoom:0,minZoom:0,maxZoom:0,attributionControl:!1,zoomControl:!1,fadeAnimation:!1,zoomAnimation:!1});vt=L.GridLayer.extend({createTile:function(n){var t=this.getTileSize(),s,i,r,u,e,c,h;if(n.x>f.maxX||n.x<f.minX||n.y>f.maxY||n.y<f.minY)return s=L.DomUtil.create("div","leaflet-tile zone"),s.style="width: "+t.x+"px; height: "+t.y+"px;",s;for(ut(n.x,n.y),i=L.DomUtil.create("div","leaflet-tile zone"),i.style="width: "+t.x+"px; height: "+t.y+"px; display: grid; grid-template-columns: repeat("+util.MINES_PER_ROW+", 1fr);",r="",u=0;u<util.MINES_PER_ROW;u++)for(e=0;e<util.MINES_PER_ROW;e++)c={zoneX:n.x,zoneY:n.y,cellX:e,cellY:u},h=o(c),r+="<div class='c l"+(v[h]?" f":"")+"' id='"+h+"'><span><\/span><\/div>";return r+="<div class='zonelabel'>Zone "+n.x+","+n.y+"<\/div>",i.innerHTML=r,i}});r.addQuestOverlay=function(n){n.overlay&&n.overlay.remove();n.zone&&(n.overlay=L.rectangle(dt(n.zone,n.zone2),{color:n.color,weight:1,fillOpacity:.09,interactive:!1}),n.overlay.addTo(e))};r.init=function(n,t,i,r,u,f,e,o,s){ut=n;ft=t;et=i;ot=r;st=u;ht=f;ct=e;lt=o;at=s;tt()};r.revealCell=function(n,t,r){var e=o(n),u,f;(delete v[e],u=document.getElementById(e),u)&&(f=l(u),(f===undefined||f==="f")&&(u.classList.remove("l","c","f","d"),t==="M"?(u.classList.add("m"),ht()&&r&&u.classList.add("e")):(count=Number(t),u.classList.add(isNaN(count)?"u":"c"+count))),(util.cellPointsEqual(i,n)||util.cellPointsAdjacent(i,n))&&h(i,!1))};r.revealZone=function(n,t){for(var f,u=0,i=0;i<t.length;i++)f={zoneX:n.zoneX,zoneY:n.zoneY,cellX:u%util.MINES_PER_ROW,cellY:Math.floor(u/util.MINES_PER_ROW)},t[i]===" "?gt(f):r.revealCell(f,t[i],!1),u++};nt=[];r.setKeyCursor=h;r.setTouchMode=function(n){w=n};r.getTouchMode=function(){return w};r.touchReveal=function(){i&&k(i)};r.touchFlag=function(){i&&p(i)};r.touchMagic=function(){i&&g(i)};r.setSkin=function(t){var r=u,i,f;return(t=t||n.skin||d,skinExec=bt.exec(t),!skinExec)?(console.warn("Invalid skin: "+t),!1):(document.getElementById("skin").setAttribute("href","/css/skins/"+t+".css"),i=Number(skinExec[1]||400),f=Number(skinExec[2]||i),u={w:i,h:f},d=t,y&&(r.w!==u.w||r.h!==u.h)&&tt(),ni(),!0)};r.resetSkin=function(){d!==r.defaultSkin&&at(r.defaultSkin)};r.getSkin=function(){return d};r.setBounds=function(n,t,i,r){(n!==f.minX||r!==f.maxX||i!==f.minY||r!==f.maxY)&&(f={maxX:t,minX:n,maxY:r,minY:i},tt())};r.centerKeyCursor=function(){var n=b(e.getCenter());h(n,!0)};r.isInBounds=function(n,t){return!isNaN(n)&&!isNaN(t)&&n<=f.maxX&&n>=f.minX&&t<=f.maxY&&t>=f.minY};r.clampLocation=function(n,t){return{x:util.clamp(n,f.minX,f.maxX),y:util.clamp(t,f.minY,f.maxY)}};r.panTo=function(n,t){return r.isInBounds(n,t)?(e.panTo(kt(n,t)),!0):!1};e.on("keydown",function(n){var t=n.originalEvent.key;switch(t){case"q":case"Q":s("topLeft");break;case"w":case"W":s("top");break;case"e":case"E":s("topRight");break;case"a":case"A":s("left");break;case"s":case"S":case"x":case"X":s("bottom");break;case"d":case"D":s("right");break;case"z":case"Z":s("bottomLeft");break;case"c":case"C":s("bottomRight");break;case"r":case"R":r.centerKeyCursor();break;case"Esc":case"Escape":h(null,!0);break;case"f":case"F":i&&p(i);break;case"Enter":i&&k(i);break;case" ":i&&(p(i)||g(i))}});e.on("click",function(n){var t=b(n.latlng);w?h(t,!0):(h(null,!0),k(t))});e.on("mousedown",function(n){var t,r,u,f,e,i;if((rt(),!w)&&(t=b(n.latlng),r=document.getElementById(o(t)),r)){u=l(r);f=u===undefined?n.originalEvent.button===2?[]:[t]:u==="f"?[]:n.originalEvent.button===2?util.getAdjacentPoints(t):[];for(e in f)i=document.getElementById(o(f[e])),i&&(nt.push(i),i.classList.add("d"))}});e.on("mouseup",rt);e.on("movestart",rt);e.on("moveend",function(){st(b(e.getCenter()))});e.on("contextmenu",function(n){if(!w){h(null,!0);var t=b(n.latlng);t&&(p(t)||g(t))}});return a={},window.addEventListener("gamepadconnected",function(n){document.getElementById("gamepad").classList.remove("hide");Object.keys(a).length===0&&window.requestAnimationFrame(wt);a[n.gamepad.index]={revealState:!1,flagState:!1,magicState:!1,xThresh:0,yThresh:0,directionLastPress:null,lastTimestamp:null};console.log("Gamepad connected ("+Object.keys(a).length+" total)")}),window.addEventListener("gamepaddisconnected",function(n){delete a[n.gamepad.index];Object.keys(a).length===0&&document.getElementById("gamepad").classList.add("hide")}),r}(swi.win,swi.ui);swi.game=function(n){function u(){if(t)for(var n in r)t.send("S:"+n)}function f(n){return n.zoneX+","+n.zoneY+","+n.cellX+","+n.cellY}function i(n,t,i){console.error("PROTOCOL ERROR: Code "+n+" expects "+t+" parameter(s). "+i)}var t,r={};return{init:function(n,r,f,e){var o=document.location.protocol==="https:"?"wss":"ws",s=document.location.port?":"+document.location.port:"",h=o+"://"+document.location.hostname+s+"/ws";t=new WebSocket(h);t.onerror=function(){r.error("A network error occurred.");t=undefined};t.onopen=function(){r.loggingIn();e("Opened!");n()};t.onclose=function(n){r.closed();e("Closed! Code: "+n.code+", Reason: "+n.reason);t=undefined};t.onmessage=function(n){var y,o,t,d,ft,g,l,nt,tt,et,ot,st,at,vt,yt,w,b,v,s,rt,ut,c,k,a;if(e("Message: "+n.data),y=n.data.search(":"),y<0)e("Protocol error!");else{o=n.data.substr(0,y);t=n.data.substr(y+1).split(",");switch(o){case"E":if(t.length!==1)i(o,1,n.data);else f.onError(Number(t[0]));break;case"W":if(t.length!==1)i(o,1,n.data);else{d=Number(t[0]);switch(d){case 2:console.warn("User name selection was invalid. Try again.");break;case 3:console.warn("Invalid option code.");break;case 4:console.warn("Invalid public id.");break;case 5:console.warn("Unknown user.");break;case 6:console.warn("Invalid skin value.");break;case 7:console.warn("Invalid avatar value.");break;case 8:console.warn("Invalid pocket command code.");break;default:console.warn("Unknown warning code received from server: "+d)}}break;case"L":if(t.length!==13)i(o,13,n.data),r.error("Unable to log in. Protocol error.");else{var kt={sid:t[0],pid:Number(t[1]),name:t[2],score:Number(t[3]),locationX:Number(t[4]),locationY:Number(t[5]),lootboxes:Number(t[6])},dt=t[7],gt=t[8]=="1",ni=Number.parseInt(t[9]),ti=Number.parseInt(t[10]),ii=Number.parseInt(t[11]),ri=Number.parseInt(t[12]);f.onLogin(kt,dt,gt,ni,ti,ii,ri);r.clear();u()}break;case"C":case"R":if(t.length!==5)i(o,5,n.data);else{ft={zoneX:Number(t[0]),zoneY:Number(t[1]),cellX:Number(t[2]),cellY:Number(t[3])};f.onCellReveal(ft,t[4],o==="C")}break;case"D":t.length!==1||t[0]?i(o,0,n.data):f.onDeath();break;case"O":if(t.length!==2)i(o,2,n.data);else{g=t[0];l=t[1];switch(g){case"S":f.onStealthChange(l==="1");break;case"K":if(l)f.onSkinChange(l);break;case"A":if(nt=Number(l),!isNaN(nt))f.onAvatarChange(nt);break;case"M":if(tt=Number(l),!isNaN(tt))f.onAvatarModChange(tt);break;default:console.warn("Unknown option code received from server: "+g)}}break;case"Z":if(t.length!==3)i(o,3,n.data);else{et={zoneX:Number(t[0]),zoneY:Number(t[1])};f.onZoneReveal(et,t[2])}break;case"P":if(t.length!==5)i(o,5,n.data);else{ot={zoneX:Number(t[0]),zoneY:Number(t[1]),cellX:Number(t[2]),cellY:Number(t[3])};st=Number(t[4]);f.onPoints(ot,st)}break;case"B":if(t.length!==1)i(o,1,n.data);else f.onLootbox(Number(t[0]));break;case"I":if(t.length!==10)i(o,10,n.data);else{var it=Number(t[0]),p=t[1]==="1",ht=Number(t[2]),ct=Number(t[3]),lt=t[9]&&t[9].replace(/\\\\\\\\/g,",");switch(it){case 2:at=Number(t[8]);vt={type:2,friendlyName:t[4],avatarId:Number(t[5]),avatar:t[6],avatarMale:t[7],avatarMod:at,flavorText:lt,isNew:p};f.onAvatarReceived(vt,p,ht,ct);break;case 3:yt={type:3,friendlyName:t[4],skinId:t[5],flavorText:lt,isNew:p};f.onSkinReceived(yt,p,ht,ct);break;default:e("Unknown item type: "+it)}}break;case"M":if(t.length!==2)i(o,2,n.data);else f.onForceMove({zoneX:Number(t[0]),zoneY:Number(t[1])});break;case"N":if(t.length!==1)i(o,1,n.data);else f.onNameChange(t[0]);break;case"Q":if(t.length<5)i(o,5,n.data);else if(w=Number(t[0]),b=Number(t[1]),b===0)f.onQuestDismiss(w);else{var ui=new Date(t[2]),fi=Number(t[3]),ei=Number(t[4]),h={id:w,type:b,expirationTime:ui,reward:{lootboxes:fi,points:ei},zone:{zoneX:Number(t[6]),zoneY:Number(t[7])}};switch(b){case 1:t.length!==8?(console.error("PROTOCOL ERROR: Code Q (type 1) expects 8 parameters. "+n.data),h=undefined):(h.description="Clear the highlighted area",h.progress=Number(t[5]),h.maxProgress=256,h.zone={zoneX:Number(t[6]),zoneY:Number(t[7])});break;case 2:default:e("Unknown quest type: "+it);h=undefined}if(h)f.onQuestUpdate(w,h)}break;case"S":if(v=10,t.length%v!=0)console.error("PROTOCOL ERROR: Code S expects parameters in multiples of "+v+". "+n.data);else{s=[];t.forEach(function(n,t){var i=Math.floor(t/v);switch(t%v){case 0:s[i]={name:n};break;case 1:s[i].pid=Number(n);break;case 2:s[i].score=Number(n);break;case 3:isNaN(s[i].locationX=Number(n))&&(s[i].stealthMode=!0);break;case 4:isNaN(s[i].locationY=Number(n))&&(s[i].stealthMode=!0);break;case 5:s[i].isDead=n==="1";break;case 6:s[i].isActive=n==="1";break;case 7:s[i].avatar=n;break;case 8:s[i].avatarMale=n;break;case 9:s[i].avatarMod=Number(n)}});f.onScoreboardUpdate(s)}break;case"T":if(t.length!==2)i(o,2,n.data);else{rt=t[0];ut=t[1];switch(rt){case"C":f.onCleared(Number.parseInt(ut));break;case"P":f.onFieldCreatingFromOther();break;case"F":f.onFieldCreatedFromOther(ut);break;default:console.warn("Unknown instance code received from server: "+rt)}}break;case"V":if(c=3,t.length%c!=0)console.error("PROTOCOL ERROR: Code V expects parameters in multiples of "+c+". "+n.data);else{for(k={baubles:[],avatars:[],skins:[]},a=0;a<t.length/c;a++){var oi=Number(t[a*c]),pt=t[a*c+1],wt=Number(t[a*c+2]);switch(oi){case 2:k.avatars.push({name:pt,quantity:wt});break;case 3:k.skins.push({name:pt,quantity:wt})}}f.onInventory(k)}break;case"X":t.forEach(function(n){console.log(n)});break;case"Y":if(t.length<2)i(o,2,n.data);else{var bt=Number(t[0]),si=Number(t[1]),hi=Number(t[2]);switch(bt){case 1:f.onZoneRatingUpdate(si,hi);break;default:console.warn("Unknown type (code Y): "+bt)}}break;default:console.warn("Unknown code: "+o)}}}},login:function(i,r,u){if(t){var e,f;r?f=r.sizeX+"/"+r.sizeY+"/"+util.clamp(Math.round(r.prob/100*255),0,255)+"/"+(r.old||""):(e=n.getCookie(u?"sid-"+u.toUpperCase():"sid"),f=u||"");t.send("L:"+(e||"")+","+(i?1:0)+","+f)}},resetGame:function(t){n.setCookie(t?"sid-"+t.toUpperCase():"sid",null,!!t)},saveSid:function(t,i){n.setCookie(i?"sid-"+i.toUpperCase():"sid",t,!!i)},setSkin:function(n){t&&t.send("O:K,"+n)},setAvatar:function(n){t&&t.send("O:A,"+(n||""))},setAvatarMod:function(n){t&&t.send("O:M,"+n)},setStealthMode:function(n){t&&t.send("O:S,"+(n?"1":"0"))},changeName:function(n){if(t)return t.send("N:"+n),!0},consumeLootbox:function(n){t&&t.send("B:"+n)},goRandom:function(){t&&t.send("R:1")},requestInventory:function(){if(t)return t.send("V:"),!0},subscribeToZone:function(n,i){var u=n+","+i;r[u]=!0;t&&t.send("S:"+u)},unsubscribeToZone:function(n,i){r[n+","+i]&&(delete r[n+","+i],t&&t.send("U:"+n+","+i))},flagCells:function(n){if(t)return t.send("F:"+n.map(function(n){return f(n)}).join(",")),!0},revealCell:function(n){if(t)return t.send("C:"+n.zoneX+","+n.zoneY+","+n.cellX+","+n.cellY),!0},setLocation:function(n,i){t&&t.send("M:"+n+","+i)},notifyFieldCreating:function(){t&&t.send("T:P")},terminate:function(){t&&(t.send("Z:"),t.onclose=function(){},t.close())}}}(swi.store);swapp={},function(n,t,i,r,u){function rt(){for(var t,n=c.length-1;n>0;n--){if(t=c[v%c.length],!e.find(function(n){return n.color===t}))break;v++}return v++}function y(t){if(i.setSkin(t)){var r=b(t);n.setSkinOption(t);n.setSkinPreview(t,r&&r.flavorText)}}function b(n){return a.find(function(t){return t.skinId===n})}function k(t){s=t;n.setAvatarOption(t);var i={};t&&(i=o.find(function(n){return n.avatarId===t})||{});n.setUserAvatar(swavatar.getAvatar(i.avatar,i.avatarMale,i.avatarMod,l));swapp.showAvatarPreview()}function d(t){l=t;n.setAvatarMod(t);var i={};s&&(i=o.find(function(n){return n.avatarId===s})||{});n.setUserAvatar(swavatar.getAvatar(i.avatar,i.avatarMale,i.avatarMod,l));swapp.showAvatarPreview()}function ut(n){b(n.skinId)||(a.push(n),a.sort(function(n,t){return n.skinId==="base"?-1:t.skinId==="base"?1:util.stringSort(n.friendlyName,t.friendlyName)}),g())}function g(){n.loadSkinOptions(a,i.getSkin())}function ft(t){if(o.some(function(n){return n.avatarId===t.avatarId})||(o.push(t),o.sort(function(n,t){return util.stringSort(n.friendlyName,t.friendlyName)}),nt()),s===t.avatarId){var i=swavatar.getAvatar(t.avatar,t.avatarMale,t.avatarMod,l);n.setAvatarOption(i,t.avatarMod);n.setUserAvatar(i)}}function nt(){var t=o.find(function(n){return n.avatarId===s});n.loadAvatarOptions(o,t);t&&swapp.showAvatarPreview()}function et(n){e.push(n);w()}function ot(n){var i=e.findIndex(function(t){return t.id===n}),t=e[i];t&&(t.overlay&&t.overlay.remove(),e.splice(i,1),w())}function w(){var t=n.updateQuests(e);for(var r in t)i.addQuestOverlay(t[r])}function st(t){f&&(t.zoneX!==f.locationX||t.zoneY!==f.locationY)&&(f.previousLocationX=f.locationX,f.previousLocationY=f.locationY,f.locationX=t.zoneX,f.locationY=t.zoneY,r.setLocation(f.locationX,f.locationY),n.setTeleportCoords(f.locationX,f.locationY))}function ht(){return f.isDead}function ct(){f&&swapp.teleportTo(f.locationX,f.locationY)}function lt(){return e}function it(t){i.setTouchMode(t);u.setCookie("touch",t?"1":"0");n.touch.setMode(t);t||i.setKeyCursor(null,!1)}function at(){var n;!t.pocketInstance&&t.sizeX&&t.sizeY&&(n={sizeX:t.sizeX,sizeY:t.sizeY,prob:t.prob||17.6,old:t.old});r.login(t.recenterflag,n,t.pocketInstance);t.name&&r.changeName(t.name)}var c=["#c00","#00c","#070","#707"],a=[{friendlyName:"Base",skinId:"base"}],s,o=[],l=0,f,e,v,h,p,tt;g();nt();y();e=[];v=0;swapp.resetSkin=function(){i.resetSkin()};swapp.selectSkin=function(t){t||(t=n.getSkinOption());y(t);r.setSkin(t)};swapp.showSkinPreview=function(){var t=n.getSkinOption()||i.getSkin(),r=b(t);n.setSkinPreview(t,r&&r.flavorText)};swapp.selectAvatar=function(t){t||(t=n.getAvatarOption());t=t||null;k(t);r.setAvatar(t)};swapp.selectAvatarMod=function(){var t=n.getAvatarMod();d(t);r.setAvatarMod(t)};swapp.showAvatarPreview=function(){var i=n.getAvatarOption(),t={},r;i&&(t=o.find(function(n){return n.avatarId===i})||{});r=swavatar.getAvatar(t.avatar,t.avatarMale,t.avatarMod,l);n.setAvatarPreview(r,t.avatarMod)};swapp.resetGame=function(n){r.resetGame(t.pocketInstance);n&&f?t.reloadAndGoto(f.locationX,f.locationY,f.name):t.reload(f&&f.name)};swapp.redirectToInfinity=function(){t.redirectToInfinity()};p={init:function(){n.overlay.showConnecting()},loggingIn:function(){n.overlay.showLoggingIn()},error:function(t){var i=Number(t);if(i>=0)switch(i){case 1:n.overlay.showAlreadyLoggedIn();break;case 2:n.overlay.showBadSecretId();break;default:n.overlay.showServerErrorCode(i)}else n.overlay.showMessage(t)},closed:function(){var i=25;window.setTimeout(function(){t.reload()},i*1e3);n.overlay.showRestartCounter(i)},clear:function(){n.overlay.hide()}};p.init();swapp.consumeLootbox=function(t){if(f.lootboxes<=0)return!1;var i=0;return(t.button===0?i=1:t.button===2&&(i=5),i=Math.min(f.lootboxes,i),i<=0)?!1:(r.consumeLootbox(i),n.setLootboxCount(f.lootboxes-=i),!0)};swapp.teleport=function(){var t=n.getTeleportCoords();swapp.teleportTo(t.x,t.y)};swapp.teleportTo=function(t,r){n.log("TELEPORT TO: "+t+","+r);i.panTo(t,r)&&n.setTeleportCoords(t,r)};swapp.toggleCoords=function(){n.toggleShowTeleportCoords()};swapp.goRandom=function(){r.goRandom()};swapp.goBack=function(){swapp.teleportTo(f.previousLocationX,f.previousLocationY)};swapp.addFavorite=function(){};swapp.changeName=function(){var t="";name=n.getNameChange();/^[a-z0-9#()/&!?""'\-_+=][a-z0-9#()/&!?""'\-_+= ]{1,18}[a-z0-9#()/&!?""'\-_+=]$/i.test(name)?r.changeName(name)||(t="Server could not be reached. Check your connection."):t="Name invalid. Name must be between 3 and 20 characters with letters, numbers, spaces (not at the beginning or end), and any of the following characters: #()/&!?\"'-_+=";n.showMenuError(t)};swapp.changeStealthMode=function(){r.setStealthMode(n.getStealthMode())};swapp.changeSid=function(){var u="",i=n.getSidChange();util.validateSid(i)?(r.saveSid(i,t.pocketInstance),t.reload()):(u="Invalid Secret ID (Make sure you have all 24 characters!)",console.error("Invalid SID (not a 16 byte base64 string): "+i));n.showMenuError(u)};swapp.closeMenu=function(){n.toggleMenu(!1)};swapp.toggleMenu=function(){n.toggleMenu()};swapp.closeUserSettings=function(){n.showUserSettings(!1)};swapp.openUserSettings=function(){n.setSidChange(f.sid);n.setNameChange(f.name);n.setSkinOption(i.getSkin());swapp.showSkinPreview();n.setAvatarOption(s);swapp.showAvatarPreview();n.showUserSettings(!0)};swapp.toggleScoreboardSize=function(){n.toggleScoreboardSize()};swapp.closeUserProfile=function(){n.showUserProfile(!1)};swapp.viewUserProfile=function(t){var i=new XMLHttpRequest;i.open("GET","/st?pid="+t+"&instance="+(h||""),!0);i.responseType="json";i.onload=function(){var t=i.status;t===200?n.showUserProfile(!0,i.response):t===404?n.showUserProfile(!1):n.showUserProfile(!1)};i.send();n.showUserProfile(!0)};swapp.showLeaderboard=function(){var t=new XMLHttpRequest;t.open("GET","/lb?instance="+(h||""),!0);t.responseType="json";t.onload=function(){var i=t.status;i===200?n.showLeaderboardArea(!0,null,t.response):n.showLeaderboardArea(!0,"Request failed: "+i,null)};t.send();n.showLeaderboardArea(!0,"Loading...",null)};swapp.closeLeaderboard=function(){n.showLeaderboardArea(!1)};swapp.closeItemArea=function(){n.closeItemArea()};swapp.dismissItem=function(t){n.dismissItem(t.target)};swapp.openInventory=function(){r.requestInventory()&&n.showInventoryArea(!0)};swapp.closeInventory=function(){n.showInventoryArea(!1)};swapp.openHelp=function(){n.showHelpArea(!0)};swapp.closeHelp=function(){n.showHelpArea(!1)};swapp.openPocket=function(){n.showPocketArea(!0);r.notifyFieldCreating()};swapp.closePocket=function(){n.showPocketArea(!1)};swapp.createPocket=function(){var i=n.getPocketSettings();t.createPocket(i.size,i.prob,f.name)};k(null);tt={onError:function(n){p.error(n)},onLogin:function(u,e,o,s,c,l,a){f=u;h=e;Number.isInteger(s)&&Number.isInteger(c)&&Number.isInteger(l)&&Number.isInteger(a)&&i.setBounds(s,c,l,a);var v=i.clampLocation(f.locationX,f.locationY);n.setName(f.name);n.setScore(f.score);swapp.teleportTo(v.x,v.y);t.goto&&swapp.teleportTo(t.goto.x,t.goto.y);h&&o&&(t.pocketInstance=h,t.resetUrlWithInstance(h));r.saveSid(f.sid,t.pocketInstance);f.lootboxes>0&&n.setLootboxCount(f.lootboxes)},onStealthChange:function(t){n.setStealthMode(t)},onSkinChange:function(n){t.skin||y(n)},onAvatarChange:function(n){k(n)},onAvatarModChange:function(n){d(n)},onNameChange:function(t){f.name=t;n.setName(t)},onCellReveal:i.revealCell,onZoneReveal:i.revealZone,onPoints:function(t,i){n.setScore(f.score+=i)},onLootbox:function(t){n.setLootboxCount(f.lootboxes+=t)},onAvatarReceived:function(t,i,r,u){ft(t);i&&n.showItemReceived(t,u)},onSkinReceived:function(t,i,r,u){ut(t);i&&n.showItemReceived(t,u)},onDeath:function(){f.isDead=!0;n.showGameOver()},onCleared:function(t){n.showCleared(t)},onFieldCreatingFromOther:function(){n.showFieldCreating()},onFieldCreatedFromOther:function(i){n.showFieldCreated(function(){t.reload(f&&f.name,i)})},onForceMove:function(n){swapp.teleportTo(n.zoneX,n.zoneY)},onQuestDismiss:ot,onQuestUpdate:function(n,t){var i=e.find(function(t){return t.id===n});i?(i.progress=t.progress,w()):(t.index=rt(),t.color=c[t.index%c.length],et(t))},onScoreboardUpdate:function(t){t.forEach(function(n){if(n.isMe=n.pid===f.pid,!n.stealthMode){var t=n.locationX-f.locationX,i=n.locationY-f.locationY,r=Math.atan2(t,-i);slot=Math.floor(r/Math.PI*16+16.5);n.bearing=["S","SbW","SSW","SWbS","SW","SWbW","WSW","WbS","W","WbN","WNW","NWbW","NW","NWbN","NNW","NbW","N","NbE","NNE","NEbN","NE","NEbE","ENE","EbN","E","EbS","ESE","SEbE","SE","SEbS","SSE","SbE","S"][slot];n.distance=(Math.hypot(t,i)*util.MINES_PER_ROW).toFixed(0)}});n.updateScoreboard(t)},onProfile:function(t){n.showUserProfile(!0,t)},onInventory:n.showInventory,onZoneRatingUpdate:n.setZoneRating};i.init(r.subscribeToZone,r.unsubscribeToZone,r.revealCell,r.flagCells,st,ht,ct,lt,y);w();swapp.touchReveal=i.touchReveal;swapp.touchFlag=i.touchFlag;swapp.touchMagic=i.touchMagic;it(u.getCookie("touch")==="1");swapp.touchMode=function(){it(!i.getTouchMode())};r.init(at,p,tt,n.log);t.registerCode("iddqd",function(){n.setDebugMode(!n.debugmode)});window.onbeforeunload=r.terminate}(swi.ui,swi.win,swi.field,swi.game,swi.store);